---
description: Создать или обновить конституцию проекта из интерактивных или предоставленных входных данных принципов, обеспечивая синхронизацию всех зависимых шаблонов.
handoffs: 
  - label: Построить спецификацию
    agent: speckit.specify
    prompt: Реализовать спецификацию функции на основе обновленной конституции. Я хочу построить...
---

## Ввод пользователя

```text
$ARGUMENTS
```

Вы **ДОЛЖНЫ** учитывать ввод пользователя перед продолжением (если он не пустой).

## План

Вы обновляете конституцию проекта в `.specify/memory/constitution.md`. Этот файл является ШАБЛОНОМ, содержащим токены-плейсхолдеры в квадратных скобках (например, `[PROJECT_NAME]`, `[PRINCIPLE_1_NAME]`). Ваша задача — (a) собрать/вывести конкретные значения, (b) точно заполнить шаблон и (c) распространить любые поправки на зависимые артефакты.

Следуйте этому потоку выполнения:

1. Загрузите существующий шаблон конституции в `.specify/memory/constitution.md`.
   - Определите каждый токен-плейсхолдер вида `[ALL_CAPS_IDENTIFIER]`.
   **ВАЖНО**: Пользователь может потребовать меньше или больше принципов, чем использовано в шаблоне. Если указано число, соблюдайте его — следуйте общему шаблону. Вы обновите документ соответственно.

2. Соберите/выведите значения для плейсхолдеров:
   - Если ввод пользователя (разговор) предоставляет значение, используйте его.
   - Иначе выведите из существующего контекста репозитория (README, docs, предыдущие версии конституции, если встроены).
   - Для дат управления: `RATIFICATION_DATE` — это исходная дата принятия (если неизвестна, спросите или пометьте TODO), `LAST_AMENDED_DATE` — сегодня, если внесены изменения, иначе сохраните предыдущую.
   - `CONSTITUTION_VERSION` должен инкрементироваться согласно правилам семантического версионирования:
     - MAJOR: Обратно несовместимые удаления/переопределения управления/принципов.
     - MINOR: Добавлен новый принцип/раздел или существенно расширено руководство.
     - PATCH: Уточнения, формулировки, исправления опечаток, несемантические улучшения.
   - Если тип инкремента версии неоднозначен, предложите обоснование перед финализацией.

3. Составьте обновленное содержимое конституции:
   - Замените каждый плейсхолдер конкретным текстом (не оставляйте токены в скобках, кроме намеренно сохраненных слотов шаблона, которые проект решил пока не определять — явно обоснуйте любые оставленные).
   - Сохраните иерархию заголовков, и комментарии можно удалить после замены, если они не добавляют уточняющего руководства.
   - Убедитесь, что каждый раздел Принципа: краткая строка имени, абзац (или маркированный список), фиксирующий не подлежащие обсуждению правила, явное обоснование, если не очевидно.
   - Убедитесь, что раздел Управления перечисляет процедуру поправок, политику версионирования и ожидания проверки соответствия.

4. Чеклист распространения согласованности (преобразуйте предыдущий чеклист в активные валидации):
   - Прочитайте `.specify/templates/plan-template.md` и убедитесь, что любые "Constitution Check" или правила согласуются с обновленными принципами.
   - Прочитайте `.specify/templates/spec-template.md` для выравнивания области/требований — обновите, если конституция добавляет/удаляет обязательные разделы или ограничения.
   - Прочитайте `.specify/templates/tasks-template.md` и убедитесь, что категоризация задач отражает новые или удаленные типы задач, управляемые принципами (например, наблюдаемость, версионирование, дисциплина тестирования).
   - Прочитайте каждый файл команды в `.specify/templates/commands/*.md` (включая этот), чтобы проверить отсутствие устаревших ссылок (имена, специфичные для агента, такие как CLAUDE только), когда требуется общее руководство.
   - Прочитайте любые документы руководства времени выполнения (например, `README.md`, `docs/quickstart.md` или файлы руководства, специфичные для агента, если присутствуют). Обновите ссылки на измененные принципы.

5. Создайте Отчет о влиянии синхронизации (добавьте как HTML-комментарий в начало файла конституции после обновления):
   - Изменение версии: старая → новая
   - Список измененных принципов (старый заголовок → новый заголовок, если переименован)
   - Добавленные разделы
   - Удаленные разделы
   - Шаблоны, требующие обновления (✅ обновлено / ⚠ ожидает) с путями файлов
   - Последующие TODO, если какие-либо плейсхолдеры намеренно отложены.

6. Валидация перед финальным выводом:
   - Нет оставшихся необъясненных токенов в скобках.
   - Строка версии соответствует отчету.
   - Даты в формате ISO YYYY-MM-DD.
   - Принципы декларативны, проверяемы и свободны от расплывчатого языка ("should" → замените на MUST/SHOULD с обоснованием, где уместно).

7. Запишите завершенную конституцию обратно в `.specify/memory/constitution.md` (перезаписать).

8. Выведите финальную сводку пользователю с:
   - Новой версией и обоснованием инкремента.
   - Любыми файлами, помеченными для ручного последующего действия.
   - Предложенным сообщением коммита (например, `docs: amend constitution to vX.Y.Z (principle additions + governance update)`).

Требования к форматированию и стилю:

- Используйте заголовки Markdown точно как в шаблоне (не понижайте/повышайте уровни).
- Переносите длинные строки обоснования для сохранения читаемости (<100 символов в идеале), но не применяйте жестко с неудобными разрывами.
- Сохраняйте одну пустую строку между разделами.
- Избегайте завершающих пробелов.

Если пользователь предоставляет частичные обновления (например, только одну ревизию принципа), все равно выполните шаги валидации и решения версии.

Если критическая информация отсутствует (например, дата ратификации действительно неизвестна), вставьте `TODO(<FIELD_NAME>): explanation` и включите в Отчет о влиянии синхронизации под отложенными элементами.

Не создавайте новый шаблон; всегда работайте с существующим файлом `.specify/memory/constitution.md`.
