---
description: Сгенерировать действенный, упорядоченный по зависимостям tasks.md для функции на основе доступных артефактов проектирования.
handoffs: 
  - label: Проанализировать на согласованность
    agent: speckit.analyze
    prompt: Запустить анализ проекта на согласованность
    send: true
  - label: Реализовать проект
    agent: speckit.implement
    prompt: Начать реализацию по фазам
    send: true
---

## Ввод пользователя

```text
$ARGUMENTS
```

Вы **ДОЛЖНЫ** учитывать ввод пользователя перед продолжением (если он не пустой).

## План

1. **Настройка**: Запустите `.specify/scripts/powershell/check-prerequisites.ps1 -Json` из корня репозитория и распарсите список FEATURE_DIR и AVAILABLE_DOCS. Все пути должны быть абсолютными. Для одинарных кавычек в аргументах типа "I'm Groot" используйте синтаксис экранирования: например, 'I'\''m Groot' (или двойные кавычки, если возможно: "I'm Groot").

2. **Загрузите документы проектирования**: Прочитайте из FEATURE_DIR:
   - **Обязательно**: plan.md (технологический стек, библиотеки, структура), spec.md (пользовательские истории с приоритетами)
   - **Опционально**: data-model.md (сущности), contracts/ (конечные точки API), research.md (решения), quickstart.md (тестовые сценарии)
   - Примечание: Не все проекты имеют все документы. Генерируйте задачи на основе того, что доступно.

3. **Выполните рабочий процесс генерации задач**:
   - Загрузите plan.md и извлеките технологический стек, библиотеки, структуру проекта
   - Загрузите spec.md и извлеките пользовательские истории с их приоритетами (P1, P2, P3 и т.д.)
   - Если существует data-model.md: Извлеките сущности и сопоставьте с пользовательскими историями
   - Если существует contracts/: Сопоставьте конечные точки с пользовательскими историями
   - Если существует research.md: Извлеките решения для задач настройки
   - Сгенерируйте задачи, организованные по пользовательским историям (см. Правила генерации задач ниже)
   - Сгенерируйте граф зависимостей, показывающий порядок завершения пользовательских историй
   - Создайте примеры параллельного выполнения для каждой пользовательской истории
   - Валидируйте полноту задач (каждая пользовательская история имеет все необходимые задачи, независимо проверяема)

4. **Сгенерируйте tasks.md**: Используйте `.specify/templates/tasks-template.md` как структуру, заполните:
   - Правильное имя функции из plan.md
   - Фаза 1: Задачи настройки (инициализация проекта)
   - Фаза 2: Базовые задачи (блокирующие предварительные условия для всех пользовательских историй)
   - Фаза 3+: Одна фаза на пользовательскую историю (в порядке приоритета из spec.md)
   - Каждая фаза включает: цель истории, критерии независимого тестирования, тесты (если запрошены), задачи реализации
   - Финальная фаза: Полировка и сквозные проблемы
   - Все задачи должны следовать строгому формату чеклиста (см. Правила генерации задач ниже)
   - Четкие пути файлов для каждой задачи
   - Раздел зависимостей, показывающий порядок завершения историй
   - Примеры параллельного выполнения для каждой истории
   - Раздел стратегии реализации (MVP сначала, инкрементальная доставка)

5. **Отчет**: Выведите путь к сгенерированному tasks.md и сводку:
   - Общее количество задач
   - Количество задач на пользовательскую историю
   - Выявленные возможности параллелизма
   - Критерии независимого тестирования для каждой истории
   - Предложенная область MVP (обычно только Пользовательская история 1)
   - Валидация формата: Подтвердите, что ВСЕ задачи следуют формату чеклиста (чекбокс, ID, метки, пути файлов)

Контекст для генерации задач: $ARGUMENTS

tasks.md должен быть немедленно выполнимым — каждая задача должна быть достаточно конкретной, чтобы LLM мог завершить ее без дополнительного контекста.

## Правила генерации задач

**КРИТИЧНО**: Задачи ДОЛЖНЫ быть организованы по пользовательским историям, чтобы обеспечить независимую реализацию и тестирование.

**Тесты ОПЦИОНАЛЬНЫ**: Генерируйте задачи тестов только если явно запрошено в спецификации функции или если пользователь запрашивает подход TDD.

### Формат чеклиста (ОБЯЗАТЕЛЬНО)

Каждая задача ДОЛЖНА строго следовать этому формату:

```text
- [ ] [IDЗадачи] [П?] [История?] Описание с путем к файлу
```

**Компоненты формата**:

1. **Чекбокс**: ВСЕГДА начинайте с `- [ ]` (чекбокс markdown)
2. **ID задачи**: Последовательный номер (T001, T002, T003...) в порядке выполнения
3. **Маркер [P]**: Включайте ТОЛЬКО если задача параллелизуема (разные файлы, нет зависимостей от незавершенных задач)
4. **Метка [История]**: ОБЯЗАТЕЛЬНО только для задач фаз пользовательских историй
   - Формат: [ИС1], [ИС2], [ИС3] и т.д. (сопоставляется с пользовательскими историями из spec.md)
   - Фаза настройки: БЕЗ метки истории
   - Базовая фаза: БЕЗ метки истории
   - Фазы пользовательских историй: ДОЛЖНЫ иметь метку истории
   - Фаза полировки: БЕЗ метки истории
5. **Описание**: Четкое действие с точным путем файла

**Примеры**:

- ✅ ПРАВИЛЬНО: `- [ ] T001 Создать структуру проекта согласно плану реализации`
- ✅ ПРАВИЛЬНО: `- [ ] T005 [P] Реализовать middleware аутентификации в src/middleware/auth.py`
- ✅ ПРАВИЛЬНО: `- [ ] T012 [П] [ИС1] Создать модель Пользователь в src/models/user.py`
- ✅ ПРАВИЛЬНО: `- [ ] T014 [ИС1] Реализовать СервисПользователя в src/services/user_service.py`
- ❌ НЕПРАВИЛЬНО: `- [ ] Создать модель Пользователь` (отсутствует ID и метка истории)
- ❌ НЕПРАВИЛЬНО: `T001 [ИС1] Создать модель` (отсутствует чекбокс)
- ❌ НЕПРАВИЛЬНО: `- [ ] [ИС1] Создать модель Пользователь` (отсутствует ID задачи)
- ❌ НЕПРАВИЛЬНО: `- [ ] T001 [ИС1] Создать модель` (отсутствует путь файла)

### Организация задач

1. **Из пользовательских историй (spec.md)** — ПЕРВИЧНАЯ ОРГАНИЗАЦИЯ:
   - Каждая пользовательская история (P1, P2, P3...) получает свою фазу
   - Сопоставьте все связанные компоненты с их историей:
     - Модели, необходимые для этой истории
     - Сервисы, необходимые для этой истории
     - Конечные точки/UI, необходимые для этой истории
     - Если запрошены тесты: Тесты, специфичные для этой истории
   - Отметьте зависимости историй (большинство историй должны быть независимыми)

2. **Из контрактов**:
   - Сопоставьте каждый контракт/конечную точку → с пользовательской историей, которой она служит
   - Если запрошены тесты: Каждый контракт → задача теста контракта [P] перед реализацией в фазе этой истории

3. **Из модели данных**:
   - Сопоставьте каждую сущность с пользовательской историей(ями), которым она нужна
   - Если сущность служит нескольким историям: Поместите в самую раннюю историю или фазу настройки
   - Связи → задачи слоя сервисов в соответствующей фазе истории

4. **Из настройки/инфраструктуры**:
   - Общая инфраструктура → Фаза настройки (Фаза 1)
   - Базовые/блокирующие задачи → Базовая фаза (Фаза 2)
   - Настройка, специфичная для истории → в фазе этой истории

### Структура фаз

- **Фаза 1**: Настройка (инициализация проекта)
- **Фаза 2**: Базовая (блокирующие предварительные условия — ДОЛЖНЫ быть завершены перед пользовательскими историями)
- **Фаза 3+**: Пользовательские истории в порядке приоритета (P1, P2, P3...)
  - Внутри каждой истории: Тесты (если запрошены) → Модели → Сервисы → Конечные точки → Интеграция
  - Каждая фаза должна быть полным, независимо проверяемым инкрементом
- **Финальная фаза**: Полировка и сквозные проблемы
